@layout LoginLayout
@page "/"
@using LTS_Proto.BL.Models
@using LTS_Proto.Web.Data
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject Blazored.SessionStorage.ISessionStorageService sessionStorage
@inject NavigationManager NavMgr


<div class="jumbotron">
    <div>
        <h2 class="text-center">Latis Prototipo</h2>
        <h3 class="text-center">Login</h3>
        <EditForm Model="@usr" OnValidSubmit="@UsrVld">
            <div>
                <div class="form-group">
                    <label>Usuario</label>
                    <input class="form-control col" @bind="usr.Usr" placeholder="Usuario" />
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" class="form-control col" @bind="usr.Psw" placeholder="Password" />
                </div>
            </div>
            <div class="text-center">
                <div class="form-group">
                    <input type="submit" class="form-control col-6 btn btn-primary" value="Login" />
                </div>
            </div>
        </EditForm>
    </div>
</div>


@code {
    private UsrModel usr;

    protected override Task OnInitializedAsync()
    {
        usr = new UsrModel();
        return base.OnInitializedAsync();
    }

    protected async Task<bool> UsrVld()
    {
        ((UsrAuthenticationStateProvider)AuthenticationStateProvider).MarkUsrAsAuth(usr.Usr);
        NavMgr.NavigateTo("/index");

        await sessionStorage.SetItemAsync("usr", usr.Usr);

        return await Task.FromResult(true);
    }
}
